<div class="wikidoc"><h1>Configuring KiGG to use MySQL Database through Entity Framework</h1>
<h2>Introduction</h2>This article is concerned with configuring KiGG to use MySQL database through Entity Framework Repository Provider. It is mandatory that your read <a href="https://kigg.codeplex.com/wikipage?title=KiGG%20Entity%20Framework%20Configuration&referringTitle=Configuring%20KiGG%20to%20use%20MySQL%20Database%20through%20Entity%20Framework">How to configure KiGG to use Entity Framework Repository</a> first and apply the settings mentioned in that article.<br />
<h2>Creating and preparing KiGG MySQL Database</h2>Along with KiGG source code -<i>so far no deployment package or offecial release for KiGG 2.5</i>- you&#39;ll find a folder named <b>Database</b>. Within this folder all SQL Scripts required to create <a href="http://dev.mysql.com/downloads/">MySQL</a> database are available.<br />KiGG currently supports 2 providers of MySQL .Net Data Providers
<ul><li><a href="http://www.devart.com/dotconnect/mysql/">Devart .Net Data Provider for MySQL</a> (Professional Edition Commercial)</li>
<li><a href="http://dev.mysql.com/downloads/connector/net/6.0.html">MySQL Connector/net</a> (<i>Modified</i> this is not the original one provided by MySQL. Our modified version contain few bug fixes)</li></ul>
<b>Devart dotConnect Provider for MySQL supported Database Schema</b>:
<ol><li>MySQL.Devart.KiGG.Schema.Administrator.Tool.Restore.sql: To be use with MySQL Administrator Restore tool</li>
<li>MySQL.Devart.KiGG.Schema.Raw.Script.sql: Normal script, Will create database with name Kigg and then create the database schema.</li></ol>
<br /><b>MySQL Connector/net supported Database Schema</b>:
<ol><li>MySQL.Connector.KiGG.Schema.Administrator.Tool.Restore.sql: To be use with MySQL Administrator Restore tool</li>
<li>MySQL.Connector.KiGG.Schema.Raw.Script.sql: Normal script, Will create database with name Kigg and then create the database schema.</li></ol>
<br /><b>Difference between both schemas</b>:<br />Only one major difference between the above 2 schemas. Current Devart provider support GUID as varchar or char field.<br />Connector\net provider support GUID as binary(16) field. So I had to make 2 different schemas to support both providers.<br /><br />Choose your preffered way to create your database, but remember its name and credentials as they will be used in ConnectionString, also database name will be used as value of Schema attribute in SSDL file.<br /><br /><b>IMPORTANT NOTE</b>:<br />MySQL Connector/net 6.0.3 is the version we used to support MySQL. While I was writing this article version 6.0.4 was out. KiGG doesn&#39;t support both versions. KiGG support the assemblies provided along with its package only. The assemblies of connector/net provided with KiGG include bug fixes related to Entity Framework that we faced during development.<br />
<h2>Configuring MySQL .Net Data Provider in Web.config</h2>You&#39;ll need to configure the .Net Data Provider that you are going to use in web.config. If you are going to use MySQL connector/net -which is free- you&#39;ll need to add the following configuration in web.config: <br /><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">&lt;</span><span style="color:#A31515;">configuration</span><span style="color:Blue;">&gt;</span>
 ......
 <span style="color:Blue;">&lt;</span><span style="color:#A31515;">system.data</span><span style="color:Blue;">&gt;</span>
  <span style="color:Blue;">&lt;</span><span style="color:#A31515;">DbProviderFactories</span><span style="color:Blue;">&gt;</span>
   <span style="color:Blue;">&lt;</span><span style="color:#A31515;">add</span> <span style="color:Red;">name</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">MySQL Data Provider</span><span style="color:Black;">&quot;</span> 
      <span style="color:Red;">invariant</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">MySql.Data.MySqlClient</span><span style="color:Black;">&quot;</span> 
      <span style="color:Red;">description</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">.Net Framework Data Provider for MySQL</span><span style="color:Black;">&quot;</span> 
      <span style="color:Red;">type</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">MySql.Data.MySqlClient.MySqlClientFactory, MySql.Data, Version=6.0.3.0, Culture=neutral, PublicKeyToken=92c3c527cdfe7566</span><span style="color:Black;">&quot;</span> <span style="color:Blue;">/&gt;</span>
  <span style="color:Blue;">&lt;/</span><span style="color:#A31515;">DbProviderFactories</span><span style="color:Blue;">&gt;</span>
 <span style="color:Blue;">&lt;/</span><span style="color:#A31515;">system.data</span><span style="color:Blue;">&gt;</span>
 ......
<span style="color:Blue;">&lt;/</span><span style="color:#A31515;">configuration</span><span style="color:Blue;">&gt;</span>
</pre></div><b>Note</b>:<br />Assemblies exist in bin directory of the web application.<br />If you are going to use Devart .Net Data Provider for MySQL you&#39;ll need to add the following configuration in web.config:<br /><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">&lt;</span><span style="color:#A31515;">configuration</span><span style="color:Blue;">&gt;</span>
 ......
 <span style="color:Blue;">&lt;</span><span style="color:#A31515;">system.data</span><span style="color:Blue;">&gt;</span>
  <span style="color:Blue;">&lt;</span><span style="color:#A31515;">DbProviderFactories</span><span style="color:Blue;">&gt;</span>
   <span style="color:Blue;">&lt;</span><span style="color:#A31515;">add</span> <span style="color:Red;">name</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">dotConnect for MySQL</span><span style="color:Black;">&quot;</span> 
       <span style="color:Red;">invariant</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">Devart.Data.MySql</span><span style="color:Black;">&quot;</span> 
       <span style="color:Red;">description</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">Devart dotConnect for MySQL</span><span style="color:Black;">&quot;</span> 
       <span style="color:Red;">type</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">Devart.Data.MySql.MySqlProviderFactory, Devart.Data.MySql, Version=5.20.33.0, Culture=neutral, PublicKeyToken=09af7300eec23701</span><span style="color:Black;">&quot;</span> <span style="color:Blue;">/&gt;</span>
  <span style="color:Blue;">&lt;/</span><span style="color:#A31515;">DbProviderFactories</span><span style="color:Blue;">&gt;</span>
 <span style="color:Blue;">&lt;/</span><span style="color:#A31515;">system.data</span><span style="color:Blue;">&gt;</span>
 ......
<span style="color:Blue;">&lt;/</span><span style="color:#A31515;">configuration</span><span style="color:Blue;">&gt;</span>
</pre></div><b>Note</b>:<br />Because Devart dotConnect for MySQL is commercial we didn&#39;t include it with the source code. So after you obtain your license you&#39;ll need to add the assemblies to the bin folder.<br /><br /><b>IMPORTANT NOTE</b>:<br />Above settings for both providers is made because I don&#39;t assume that these providers are installed in GAC or configured in machine.config. So it is idle for shared hosting environment. For local development if you used Devart installer the assemblies will be added into the GAC and configuration is added to machine.config.<br />
<h2>Add Connection String for KiGG MySQL Database</h2>You&#39;ll need to add a connection string to ConnectionStrings section in web.config. So you&#39;ll need database name and credentials. In this documentation database name is <i>Kigg</i>, user id is <i>root</i> and password is <i>Pa$$w0rd</i><br /><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">&lt;</span><span style="color:#A31515;">configuration</span><span style="color:Blue;">&gt;</span>
 ......
  <span style="color:Blue;">&lt;</span><span style="color:#A31515;">connectionStrings</span><span style="color:Blue;">&gt;</span>
    <span style="color:Blue;">&lt;</span><span style="color:#A31515;">clear</span><span style="color:Blue;">/&gt;</span>
    .....
    <span style="color:Green;">&lt;!--MySQL Connection String using Connector/net .Net Data Provider--&gt;</span>
    <span style="color:Blue;">&lt;</span><span style="color:#A31515;">add</span> <span style="color:Red;">name</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">KiGGMySqlDatabase</span><span style="color:Black;">&quot;</span>
         <span style="color:Red;">connectionString</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">server=localhost;user id=root;password=Pa$$w0rd;persist security info=True;database=kigg</span><span style="color:Black;">&quot;</span>
         <span style="color:Red;">providerName</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">MySql.Data.MySqlClient</span><span style="color:Black;">&quot;</span><span style="color:Blue;">/&gt;</span>
    <span style="color:Green;">&lt;!--MySQL Connection String using Devart dotConnect for MySql .Net Data Provider--&gt;</span>
    <span style="color:Blue;">&lt;</span><span style="color:#A31515;">add</span> <span style="color:Red;">name</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">KiGGDevartMySqlDatabase</span><span style="color:Black;">&quot;</span>
         <span style="color:Red;">connectionString</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">server=localhost;user id=root;password=Pa$$w0rd;persist security info=True;database=kigg</span><span style="color:Black;">&quot;</span>
         <span style="color:Red;">providerName</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">Devart.Data.MySql</span><span style="color:Black;">&quot;</span><span style="color:Blue;">/&gt;</span>
  <span style="color:Blue;">&lt;/</span><span style="color:#A31515;">connectionStrings</span><span style="color:Blue;">&gt;</span>
 ......
<span style="color:Blue;">&lt;/</span><span style="color:#A31515;">configuration</span><span style="color:Blue;">&gt;</span>
</pre></div><b>Note</b>:<br />Above code include 2 samples of connection MySQL using the 2 .Net Data Providers for MySQL we mentioned before. Later in configuration you&#39;ll specify the <i>ConnectionString</i> name that will be used.<br />
<h2>Configuring IConnectionString depedency mapping -<i>IEFConnectionString</i>-</h2>This section require that you read and applied <a href="https://kigg.codeplex.com/wikipage?title=KiGG%20Entity%20Framework%20Configuration&referringTitle=Configuring%20KiGG%20to%20use%20MySQL%20Database%20through%20Entity%20Framework&ANCHOR#IEFConnectionString">How to configure KiGG to use Entity Framework Repository</a>. Specifically configuration of IConnectionString interface dependency mapping under unity.<br />Find mapping for IConnectionString -Which is IEFConnectionString in typeAliases defined above- interface and change it<br /><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">&lt;</span><span style="color:#A31515;">unity</span><span style="color:Blue;">&gt;</span>
    <span style="color:Blue;">&lt;</span><span style="color:#A31515;">typeAliases</span><span style="color:Blue;">&gt;</span>
	....
    <span style="color:Blue;">&lt;/</span><span style="color:#A31515;">typeAliases</span><span style="color:Blue;">&gt;</span>
    <span style="color:Blue;">&lt;</span><span style="color:#A31515;">containers</span><span style="color:Blue;">&gt;</span>
      <span style="color:Blue;">&lt;</span><span style="color:#A31515;">container</span><span style="color:Blue;">&gt;</span>
        <span style="color:Blue;">&lt;</span><span style="color:#A31515;">types</span><span style="color:Blue;">&gt;</span>
	  ....
	 <span style="color:Blue;">&lt;</span><span style="color:#A31515;">type</span> <span style="color:Red;">type</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">IEFConnectionString</span><span style="color:Black;">&quot;</span> <span style="color:Red;">mapTo</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">EFConnectionString</span><span style="color:Black;">&quot;</span><span style="color:Blue;">&gt;</span>
            <span style="color:Blue;">&lt;</span><span style="color:#A31515;">lifetime</span> <span style="color:Red;">type</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">Singleton</span><span style="color:Black;">&quot;</span><span style="color:Blue;">/&gt;</span>
            <span style="color:Blue;">&lt;</span><span style="color:#A31515;">typeConfig</span> 
            <span style="color:Red;">extensionType</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">Microsoft.Practices.Unity.Configuration.TypeInjectionElement, Microsoft.Practices.Unity.Configuration</span><span style="color:Black;">&quot;</span><span style="color:Blue;">&gt;</span>
              <span style="color:Blue;">&lt;</span><span style="color:#A31515;">constructor</span><span style="color:Blue;">&gt;</span>
                <span style="color:Blue;">&lt;</span><span style="color:#A31515;">param</span> <span style="color:Red;">name</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">configuration</span><span style="color:Black;">&quot;</span> <span style="color:Red;">parameterType</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">IConfigurationManager</span><span style="color:Black;">&quot;</span><span style="color:Blue;">&gt;</span>
                  <span style="color:Blue;">&lt;</span><span style="color:#A31515;">dependency</span><span style="color:Blue;">/&gt;</span>
                <span style="color:Blue;">&lt;/</span><span style="color:#A31515;">param</span><span style="color:Blue;">&gt;</span>
                <span style="color:Blue;">&lt;</span><span style="color:#A31515;">param</span> <span style="color:Red;">name</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">name</span><span style="color:Black;">&quot;</span> <span style="color:Red;">parameterType</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">System.String</span><span style="color:Black;">&quot;</span><span style="color:Blue;">&gt;</span>
                  <span style="color:Blue;">&lt;</span><span style="color:#A31515;">value</span> <span style="color:Red;">type</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">System.String</span><span style="color:Black;">&quot;</span> <span style="color:Red;">value</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">KiGGMySqlDatabase</span><span style="color:Black;">&quot;</span><span style="color:Blue;">/&gt;</span>
                <span style="color:Blue;">&lt;/</span><span style="color:#A31515;">param</span><span style="color:Blue;">&gt;</span>
                <span style="color:Blue;">&lt;</span><span style="color:#A31515;">param</span> <span style="color:Red;">name</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">edmFilesPath</span><span style="color:Black;">&quot;</span> <span style="color:Red;">parameterType</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">System.String</span><span style="color:Black;">&quot;</span><span style="color:Blue;">&gt;</span>
                  <span style="color:Blue;">&lt;</span><span style="color:#A31515;">value</span> <span style="color:Red;">type</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">System.String</span><span style="color:Black;">&quot;</span> <span style="color:Red;">value</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">|DataDirectory|</span><span style="color:Black;">&quot;</span><span style="color:Blue;">/&gt;</span>
                <span style="color:Blue;">&lt;/</span><span style="color:#A31515;">param</span><span style="color:Blue;">&gt;</span>
                <span style="color:Blue;">&lt;</span><span style="color:#A31515;">param</span> <span style="color:Red;">name</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">ssdlFileName</span><span style="color:Black;">&quot;</span> <span style="color:Red;">parameterType</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">System.String</span><span style="color:Black;">&quot;</span><span style="color:Blue;">&gt;</span>
                  <span style="color:Blue;">&lt;</span><span style="color:#A31515;">value</span> <span style="color:Red;">type</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">System.String</span><span style="color:Black;">&quot;</span> <span style="color:Red;">value</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">DomainObjects.MySql</span><span style="color:Black;">&quot;</span><span style="color:Blue;">/&gt;</span>
                <span style="color:Blue;">&lt;/</span><span style="color:#A31515;">param</span><span style="color:Blue;">&gt;</span>
              <span style="color:Blue;">&lt;/</span><span style="color:#A31515;">constructor</span><span style="color:Blue;">&gt;</span>
            <span style="color:Blue;">&lt;/</span><span style="color:#A31515;">typeConfig</span><span style="color:Blue;">&gt;</span>
          <span style="color:Blue;">&lt;/</span><span style="color:#A31515;">type</span><span style="color:Blue;">&gt;</span>
	  ....
	<span style="color:Blue;">&lt;/</span><span style="color:#A31515;">types</span><span style="color:Blue;">&gt;</span>		
     <span style="color:Blue;">&lt;/</span><span style="color:#A31515;">container</span><span style="color:Blue;">&gt;</span>
    <span style="color:Blue;">&lt;/</span><span style="color:#A31515;">containers</span><span style="color:Blue;">&gt;</span>
<span style="color:Blue;">&lt;/</span><span style="color:#A31515;">unity</span><span style="color:Blue;">&gt;</span>
</pre></div>In the above configuration for <b>IConnectionString</b> -<i>Which is IEFConnectionString in typeAliases defined above</i>- that maps to <b>EFConnectionString</b> Entity Framework repository type I wish to highlight the injected constructor parameters. 	
<ol><li>Parameter <b><i>configuration</i></b> is as it is, it maps to a configured <b>IConfigurationManager</b> that already maps to a concrete class that is independent from Entity Framework.</li>
<li>Parameter <b><i>name</i></b>, the value of this parameter is your database connection string name that you&#39;ll configure  under <i>connectionStrings</i> element.</li>
<li>Paremeter <b><i>edmFilesPath</i></b>, this is the physical path of csdl,ssdl and msl files path. By default all these files are under App_Data directory so the default value is &quot;<b>|Directory|</b>&quot;</li>
<li>Parameter <b><i>ssdlFileName</i></b>, this is the name of the SSDL file without extension. Because SSDL might be specific per .Net Data Provider then we had to define this as configurable parameter. The default value maps to SqlServer specific SSDL. Here we specify MySQL SSDL related file <i>DomainObjects.MySql</i>.</li></ol>
<b>Note</b>: Above setttings specify <i>KiGGMySqlDatabase</i> as connectionString name.<br />
<h2>Modifying SSDL file</h2>This step is optional or mandatory depending on your database name. Open the SSDL file, for each <i>EntitySet</i> and <i>Function</i> elements make sure that <i>Schema</i> attribute value is the same as your database name. E.g. following the configuration mention in this article <i>Schema</i> attribute value should be <i>kigg</i><br />
<h2>Additional Reading</h2>Read <a href="https://kigg.codeplex.com/wikipage?title=KiGG%20Entity%20Framework%20Configuration&referringTitle=Configuring%20KiGG%20to%20use%20MySQL%20Database%20through%20Entity%20Framework">How to configure KiGG to use Entity Framework Repository</a><br /><br /><b>Note</b>:<br />Sample configuration provided with source code.</div><div class="ClearBoth"></div>